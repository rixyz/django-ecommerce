{% extends "admin/change_list.html" %}
{% load i18n %}

{% block content %}
<div class="category-tabs">
    <a href="?" class="tab {% if not selected_category %}active{% endif %}">
        {% trans "All Products" %}
    </a>
    {% for category in categories %}
    <a href="?category={{ category.id }}" 
       class="tab {% if selected_category|stringformat:"s" == category.id|stringformat:"s" %}active{% endif %}">
        {{ category.title }} ({{ category.product_set.count }})
    </a>
    {% endfor %}
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        $('.delete-btn').click(function() {
            let productId = $(this).data('product-id');
            if (confirm('Are you sure you want to delete this product?')) {
                $.ajax({
                    url: `/shop/product/${productId}/delete/`,
                    type: 'DELETE',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    success: function(response) {
                        if (response.status === 'success') {
                            alert(response.message);
                            location.reload(); 
                        } else {
                            alert(response.message);
                        }
                    },
                    error: function(xhr) {
                        alert('An error occurred while deleting the product.');
                    }
                });
            }
        });
    });
</script>

{{ block.super }}
{% endblock %}